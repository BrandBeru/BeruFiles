<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <form enctype="multipart/form-data" method="post" name="fileinfo" id="fileinfo">
    <label for="token">Token</label>
    <input type="text" name="token" id="token" placeholder="Token:"><br>
    <label for="fileId">File</label>
    <input type="text" name="fileId" id="fileId" placeholder="File:">
    <p>
      <label>File to stash:
        <input type="file" id="file" required multiple />
      </label>
    </p>
    <p>
      <input type="submit" id="send" value="Stash the file!" />
    </p>
    <input type="button" value="Download" id="download">
  </form>
  <script>
    const form = document.querySelector("#fileinfo");
    const download = document.querySelector("#download")
    const token = document.querySelector("#token")

    download.addEventListener('click', async (event) => {
      const fileId = document.querySelector("#fileId")
      fetch('http://localhost:3030/api/v1/pictures/'+fileId, {
        method: "GET",
        headers: { "Authorization": "Bearer "+token.value },
      })
      .then(data => data.blob())
      .then(blob => {
        var file = window.URL.createObjectURL(blob);
        var a = document.createElement('a')
        a.href = file
        a.download = blob.type
        document.body.appendChild(a)
        a.click();
        a.remove()
      })
    })

    form.addEventListener("submit", async (event) => {
      event.preventDefault()
      const file = document.querySelector("#file")
      const formData = new FormData(form);

      formData.append('file', file.files[0])

      const response = await fetch("http://localhost:3030/api/v1/pictures/upload/", {
        method: "POST",
        headers: { "Authorization": "Bearer "+token.value },
        body: formData,
      });
    });

  </script>
</body>

</html>